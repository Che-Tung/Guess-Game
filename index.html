<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Real-World Charades Game</title>
<style>
*{box-sizing:border-box}body{font-family:Arial,Helvetica,sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;background:#f5f5f5}
#game-container{background:#fff;padding:24px 32px;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.12);width:92%;max-width:420px;text-align:center}
#top-bar{display:flex;justify-content:space-between;font-size:1.2rem;margin-bottom:24px}
#question{font-size:1.6rem;min-height:70px;margin:28px 0}
button{padding:12px 22px;margin:10px;border:none;border-radius:8px;font-size:1rem;cursor:pointer}
.correct{background:#4caf50;color:#fff}.pass{background:#ff9800;color:#fff}
label{display:block;margin:10px 0 4px;text-align:left}select{width:100%;padding:8px 10px;border:1px solid #ccc;border-radius:6px;font-size:1rem}
</style>
</head>
<body>
<div id="game-container">
  <div id="setup">
    <h2>開始新遊戲</h2>
    <label>選擇主題：</label>
    <select id="category-select">
      <option value="daily">生活用品</option>
      <option value="movie">影視作品</option>
      <option value="idiom">成語</option>
      <option value="lyrics">歌詞</option>
    </select>

    <label>遊戲時間：</label>
    <select id="time-select">
      <option value="90">90 秒</option>
      <option value="120">120 秒</option>
      <option value="150">150 秒</option>
      <option value="180">180 秒</option>
    </select>

    <button id="start-btn">開始</button>
  </div>

  <div id="game" style="display:none;">
    <div id="top-bar">
      <span id="timer">0</span>
      <span>答對：<span id="score">0</span></span>
    </div>
    <div id="question">題目</div>
    <button class="correct" id="correct-btn">答對</button>
    <button class="pass" id="pass-btn">Pass</button>
  </div>
</div>

<script>
let questionBank={},remaining={};
let currentCategory="daily",score=0,timeLeft=0,timerInterval=null;

const $=id=>document.getElementById(id);
const setupDiv=$("setup"),gameDiv=$("game"),timerSpan=$("timer"),
      scoreSpan=$("score"),questionDiv=$("question");

async function loadBank(){
  const res=await fetch("questions.json");
  if(!res.ok)throw new Error("題庫載入失敗");
  questionBank=await res.json();
  for(const k in questionBank)remaining[k]=[...questionBank[k]];
}

function randomQ(){
  let list=remaining[currentCategory];
  if(list.length===0){
    alert("題庫已用完，重新洗牌！");
    remaining[currentCategory]=[...questionBank[currentCategory]];
    list=remaining[currentCategory];
  }
  const idx=Math.floor(Math.random()*list.length);
  const q=list[idx];
  list.splice(idx,1);
  return q;
}

function nextQuestion(){ questionDiv.textContent=randomQ(); }

function tick(){
  timeLeft--; timerSpan.textContent=`${timeLeft} 秒`;
  if(timeLeft<=0){
    clearInterval(timerInterval);
    alert(`時間到！你答對了 ${score} 題`);
    location.reload();
  }
}

$("start-btn").onclick=async()=>{
  currentCategory=$("category-select").value;
  timeLeft=parseInt($("time-select").value,10);
  score=0; scoreSpan.textContent=score; timerSpan.textContent=`${timeLeft} 秒`;
  try{ await loadBank(); }catch(e){ alert(e.message); return; }
  setupDiv.style.display="none"; gameDiv.style.display="block";
  nextQuestion(); timerInterval=setInterval(tick,1000);
};

$("correct-btn").onclick=()=>{ score++; scoreSpan.textContent=score; nextQuestion(); };
$("pass-btn").onclick=nextQuestion;
</script>
</body>
</html>
